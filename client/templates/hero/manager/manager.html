<template name="heroManager">
  <div class="hero-manager">
    <h3>Slides</h3>
    <a id="create-hero-slide" alt="Add a new slide">
      <i class="fa fa-plus"></i>
      <span class="icon-text">Create a New Slide</span>
    </a>

    {{#if selectSlideOptions}}
    {{#autoForm id="selectSlide" schema=selectSlideSchema}}
    {{! We are not really submitting this form, we just use autoForm to simplify creating the select}}
    {{> afFieldInput name="selectedSlideId" options=selectSlideOptions class="slide-select" firstOption="(Select a Slide to Edit)" value=selectedHeroSlide._id}}
    {{/autoForm}}
    {{/if}}
    
    {{#with selectedHeroSlide}}
      {{> updateSlideForm}}
    {{/with}}

    <h3>Carousel</h3>
    <a id="create-hero" alt="Add a new carousel">
      <i class="fa fa-plus"></i>
      <span class="icon-text">Create a New Hero Carousel</span>
    </a>
    
    {{#if selectHeroOptions}}
    {{#autoForm id="selectHero" schema=selectHeroSchema}}
    {{! We are not really submitting this form, we just use autoForm to simplify creating the select}}
    {{> afFieldInput name="selectedHeroId" options=selectHeroOptions class="hero-select" firstOption="(Select a Hero to Edit)" value=selectedHero._id}}
    {{/autoForm}}
    {{/if}}
    
    {{#with selectedHero}}
      {{> updateHeroForm}}
    {{/with}}
  </div>
</template>

<template name="updateHeroForm">
<div class="well">
  {{#autoForm collection="Heros" doc=. type="update" id="heroEditForm"}}
    {{> afQuickField name="name"}}
    {{> afQuickField name="showChevrons"}}
    {{> afQuickField name="slides" options=selectSlideOptions noselect=true}}
    <div class="form-group">
      <button type="submit" class="btn btn-primary">Update</button>
      <button type="button" class="btn btn-danger delete-hero" data-hero="{{../_id}}">Delete</button>
    </div>
  {{/autoForm}}
</div>
</template>

<template name="updateSlideForm">
  <div class="well">
    {{#autoForm collection="HeroSlides" doc=. type="update" id="slideEditForm"}}
    <div class="media">
      <div class="pull-left">
        {{#with media}}
          <div class="center-cropped" style="background-image: url('{{url}}');">
            <img src="{{url}}" class="product-grid-item-images img-responsive">
            <div class="slide-tools">
              <a class="image-remove-link" data-idx="{{ metadata.slideId }}">
                <i class="remove-image fa fa-times-circle fa-2x"></i>
              </a>
            </div>
          </div>
        {{else}}
          {{>heroImageUpload idx=this._id}}
        {{/with}}
      </div>
      <div class="media-body">
        <fieldset>
          {{> afQuickField name="name"}}
          {{> afQuickField name="title"}}
          {{> afQuickField name="uri"}}
          <div class="form-group">
            <button type="submit" class="btn btn-primary">Update</button>
            <button type="button" class="btn btn-danger delete-slide" data-slide="{{../_id}}">Delete</button>
          </div>
        </fieldset>
      </div>
    </div>
    {{/autoForm}}
  </div>  
</template>

<template name="heroImageUpload">
<div id="dropzone" class="dropzone">
    <input name="files" id="files" class="hidden" type="file" multiple/>
    <div class="btn btn-default select-file" id="btn-upload">Drop file to Upload</div>
</div>
</template>
